---
title: "Simulation study"
output: 
  html_document:
    theme: flatly
    toc: true
    toc_float: 
      collapsed: false
vignette: >
  %\VignetteIndexEntry{CausDiscEqVar}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(CausDiscEqVar)
library(ggplot2)
library(tidyr)
library(dplyr)
```



# Low dimensional dense setting

```{r CreateSimData, cache = TRUE, include = FALSE}
data("LowSim")
data("HighSim")
data("ArticleRes")


SIM <- rbind(LowSim, HighSim) %>%
    mutate(Kendall = Kendall * 50 + 50,
           ratio = as.factor(p/n),
           n = as.factor(n)) %>%
    gather("Kendall", "Recall", "Flipped", "FDR", "Hamming",
           key = "PrefMeasure",
           value = "Preformance", factor_key = TRUE)

ARTICLE <- ArticleRes %>%
    mutate(Kendall = Kendall * 50 + 50,
           ratio = as.factor(p/n),
           n = as.factor(n)) %>%
    gather("Kendall", "Recall", "Flipped", "FDR", "Hamming",
           key = "PrefMeasure",
           value = "Preformance", factor_key = TRUE)
```



# Low dimensional dense setting


```{r, warning = FALSE, echo = FALSE}
sim <- subset(SIM, 
              graph_setting == "dense" & l == 0.3 & 
                measure == "deviance" & which == "1se" & 
                PrefMeasure != "Hamming")
art <- subset(ARTICLE,
              graph_setting == "dense" & l == 0.3 &
                measure == "BIC" & which == "min"& 
                PrefMeasure != "Hamming")

ggplot() + 
    geom_boxplot(aes(x = n, y = Preformance, color = method), data = sim) + 
    facet_grid(p ~ PrefMeasure) + 
    geom_point(aes(x = n, y = Preformance, shape = method), 
               data = art, color = "black", 
               position = position_dodge(0.8), size = 2) + 
    ggtitle("Dense Setting  -  TD, BU  -  (1se) minimize deviance along lasso path") +
    theme(axis.title.y = element_blank(), 
          plot.title = element_text(hjust = 0.5))
```




# Low dimensional sparse setting


```{r, warning = FALSE, echo = FALSE}
sim <- subset(SIM, 
              graph_setting == "sparse" & l == 0.3 & 
                measure == "deviance" & which == "1se" &
                PrefMeasure != "Hamming")
art <- subset(ARTICLE,
              graph_setting == "sparse" & l == 0.3 &
                measure == "BIC" & which == "min" & 
                PrefMeasure != "Hamming")

ggplot() + 
    geom_boxplot(aes(x = n, y = Preformance, color = method), data = sim) + 
    facet_grid(p ~ PrefMeasure) + 
    geom_point(aes(x = n, y = Preformance, shape = method), 
               data = art, color = "black",
               position = position_dodge(0.8), size = 2) + 
    ggtitle("Dense Setting  -  TD, BU  -  (1se) minimize deviance along lasso path") +
    theme(axis.title.y = element_blank(), 
          plot.title = element_text(hjust = 0.5))
```


```{r, warning = FALSE, echo = FALSE}
sim <- subset(SIM, 
              graph_setting == "sparse" & l == 0.3 & 
                measure == "BIC" & which == "min" &
                PrefMeasure != "Hamming")
art <- subset(ARTICLE,
              graph_setting == "sparse" & l == 0.3 &
                measure == "BIC" & which == "min" &
                PrefMeasure != "Hamming")

ggplot() + 
    geom_boxplot(aes(x = n, y = Preformance, color = method), data = sim) + 
    facet_grid(p ~ PrefMeasure) + 
    geom_point(aes(x = n, y = Preformance, shape = method), 
               data = art, color ="black",
               position = position_dodge(0.8), size = 2) + 
    ggtitle("Dense Setting  -  TD, BU  -  minimize BIC score along lasso path") +
    theme(axis.title.y = element_blank(), 
          plot.title = element_text(hjust = 0.5))
```





# High dimensional setting


```{r, warning = FALSE, echo = FALSE}
sim <- subset(SIM, graph_setting %in% c("A", "B") & 
                PrefMeasure == "Kendall" & 
                n %in% c(80, 100) & ratio %in% c("0.5", "0.75", "1"))
art <- subset(ARTICLE, graph_setting %in% c("A", "B") & 
                PrefMeasure == "Kendall"& 
                n %in% c(80, 100) & ratio %in% c("0.5", "0.75", "1"))


sim <- sim %>% mutate(
  Method = ifelse(method == "HBU", 
                  ifelse(M == 0.5, "HBU (0.5)", "HBU (2.0)"), 
                  ifelse(search == "OMP", "HTD (OMP)", "HTD (B&B)"))
)
art <- art %>% mutate(
  Method = ifelse(method == "HBU", "HBU (0.5)", "HTD (B&B)")
)

lev <- c("HTD (B&B)", "HTD (OMP)", "HBU (2.0)", "HBU (0.5)")
sim$Method <- factor(sim$Method, levels = lev)
art$Method <- factor(art$Method, levels = lev)



ggplot() + 
    geom_boxplot(aes(x = n, y = (Preformance-50)/50, color = Method), 
                 data = sim) + 
    facet_grid(ratio ~ graph_setting) + 
    geom_point(aes(x = n, y = (Preformance-50)/50, shape = Method), 
               data = art, color = "black",
               position = position_dodge(1), size = 2) + 
    ggtitle("High dimensional  -  HTD, HBU") +
    theme(axis.title.y = element_blank(), 
          plot.title = element_text(hjust = 0.5))
```


